{% extends 'airs/base.html' %}
{% load rn_datetime %}

{% block title %}{{ air.name }} {{ air.started|rn_ymdhm }} {{ air.broadcaster.name }} - R.N.{% endblock title %}

{% block header %}
{% endblock header %}

{% block content %}

{% with adt=air.started|init_rn_datetime:air.ended %}
<header class="rn-padding">
  <h1 class="uk-text-lead uk-margin-remove">{{ air.name }}</h1>
  <h2 class="uk-text-default uk-margin-remove-top uk-margin-small-bottom">
    {{ air.started|rn_ymdhm }} {{ adt.airtime }}<small>min</small>
  </h2>

  {% if air.broadcaster %}
  <div class="uk-flex uk-flex-middle">
    <span uk-icon="icon: microphone" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="{% url 'airs:broadcaster' air.broadcaster.id %}">{{ air.broadcaster.name }}</a></span>
  </div>
  {% endif %}
  <div class="uk-flex uk-flex-middle">
    {% comment %} TODO ラジコのURLの生成 {% endcomment %}
    <span uk-icon="icon: link" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="#">ラジコ</a></span>
    <span class="uk-text-middle uk-margin-small-left"><a href="#">URLコピー</a></span>
    <span class="uk-text-middle uk-margin-small-left"><a href="#">ラジコ+1w</a></span>
  </div>
  {% if air.program %}
  <div class="uk-flex uk-flex-middle">
    <span uk-icon="icon: info" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="{% url 'airs:program' air.program.id %}">{{ air.program.name }}</a></span>
  </div>
  {% endif %}
</header>
{% endwith %}

{% include 'base/separator.html' %}

<div class="rn-padding">

  {% comment %} TODO:何卒→編集 {% endcomment %}
  {% if user.is_authenticated %}
  {% if is_nanitozo %}
  <a href="" class="uk-button uk-button-primary uk-width-1-1 uk-margin-bottom">何卒を編集</a>
  {% else %}
  <a href="" class="uk-button uk-button-primary uk-width-1-1 uk-margin-bottom">何卒！</a>
  {% endif %}
  {% endif %}

  {% comment %} リスナー数 {% endcomment %}
  {% include 'base/sum_reaction.html' with nanitozo_list=nanitozo_list icon='icon: user' is_negative=False %}
  {% comment %} 満足数 {% endcomment %}
  {% include 'base/sum_reaction.html' with nanitozo_list=good_nanitozo_list icon='icon: happy' is_negative=False %}
  {% comment %} 推し数 {% endcomment %}
  {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_recommend_nanitozo_list icon='icon: star' is_negative=False %}
  {% comment %} コメント数 {% endcomment %}
  {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_nanitozo_list icon='icon: comment' is_negative=False %}
  {% comment %} ネガ {% endcomment %}
  {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_negative_nanitozo_list icon='icon: paint-bucket' is_negative=True %}
</div>

{% include 'base/separator.html' %}

<div class="rn-padding">
  <h3 class="uk-text-default uk-margin-small-bottom">事前告知<small> ネタバレなし（のはず）</small></h3>
  {% if air.overview_before %}
  <div class="uk-inline">
    <p class="uk-text-small uk-margin-remove uk-text-break">{{ air.overview_before|linebreaksbr }}</p>
    <div onclick="this.remove()" class="uk-overlay-primary uk-background-secondary uk-position-cover">
      <div class="uk-position-center uk-text-small">Tap!</div>
    </div>
  </div>
  {% else %}
  <p class="uk-text-small uk-margin-remove">データなし</p>
  {% endif %}

  <h3 class="uk-text-default uk-margin-small-bottom">番組内容<small> ネタバレあり</small></h3>
  {% if air.overview_after %}
  <div class="uk-inline">
    <p class="uk-text-small uk-margin-remove uk-text-break">{{ air.overview_after|linebreaksbr }}</p>
    <div onclick="this.remove()" class="uk-overlay-primary uk-background-secondary uk-position-cover">
      <div class="uk-position-center uk-text-small">Tap!</div>
    </div>
  </div>
  {% else %}
  <p class="uk-text-small uk-margin-remove">データなし</p>
  {% endif %}

  {% if user.is_authenticated %}
  <a href="{% url 'airs:air_update' air.id %}" class="uk-button uk-button-primary uk-width-1-1 uk-margin-large-top">事前告知と番組内容を編集</a>
  {% endif %}
</div>

{% include 'base/separator.html' %}

{% include 'list/item_reaction.html' with title='推し' nanitozo_list=comment_open_recommend_nanitozo_list %}

{% include 'base/separator.html' %}

{% include 'list/item_reaction.html' with title='感想' nanitozo_list=comment_open_nanitozo_list %}

{% include 'base/separator.html' %}

{% include 'list/item_reaction.html' with title='ネガ' nanitozo_list=comment_open_negative_nanitozo_list %}

{% include 'base/separator.html' %}


<br><br><br><br><br><br><br><br><br><br>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url 'airs:vote' air.id %}" method="post">{% csrf_token %}
  {% for nanitozo in air.nanitozo_set.all %}
  <input type="radio" name="nanitozo" id="nanitozo{{ forloop.counter }}" value="{{ nanitozo.id }}">
  <label for="nanitozo{{ forloop.counter }}" class="uk-text-break">{{ nanitozo.comment }}</label><br>
  {% endfor %}
  <input type="submit" value="Vote" class="uk-button uk-button-default">
</form>

{% endblock content %}
{% extends 'airs/base.html' %}
{% load rn_const %}
{% load rn_datetime %}

{% block title %}{{ air.name }} {{ air.started_at|rn_ymdhm }} {{ air.broadcaster.name }}{% rn_const 'TITLE_SUFFIX' %}{% endblock title %}

{% block header %}
{% endblock header %}

{% block nav %}
{% if user.is_authenticated %}
<nav class="uk-navbar-container" uk-navbar>
  <div class="uk-navbar-left"></div>
  <div class="uk-navbar-right">
    <ul class="uk-navbar-nav">
      <li><a href="{% url 'airs:air_update' air.id %}">{% rn_const 'TITLE_AIR_UPDATE' %}</a></li>
      {% if my_nanitozo %}
      <li><a href="{% url 'airs:nanitozo_update' my_nanitozo.id %}">{% rn_const 'TITLE_NANITOZO_UPDATE' %}</a></li>
      {% if my_nanitozo.good == True %}
      <li><a href="javascript:window.location.replace('{% url 'airs:nanitozo_cancel_good' air_id=air.id pk=my_nanitozo.id %}')">{% rn_const 'TITLE_NANITOZO_CANCEL_GOOD' %}</a></li>
      {% else %}
      <li><a href="javascript:window.location.replace('{% url 'airs:nanitozo_apply_good' air_id=air.id pk=my_nanitozo.id %}')">{% rn_const 'TITLE_NANITOZO_APPLY_GOOD' %}</a></li>
      {% endif %}
      <li>
        <a href="#">…</a>
        <div uk-dropdown="pos: top-center">
          <ul class="uk-nav uk-navbar-dropdown-nav">
            <li>
              <a href="#nanitozo-delete" uk-toggle>{% rn_const 'TITLE_NANITOZO_DELETE' %}</a>
              <div id="nanitozo-delete" uk-modal>
                <div class="uk-modal-dialog">
                  <button class="uk-modal-close-default" type="button" uk-close></button>
                  <div class="uk-modal-header">
                    <h2 class="uk-modal-title">何卒を取り消す</h2>
                  </div>
                  <div class="uk-modal-body">
                    <p>何卒を取り消す場合は「実行」をタップ！<br><br><span class="uk-text-danger">※投稿した各種感想文も削除されます</span><br><span class="uk-text-danger">※放送は削除されないしできません（必要があれば管理者に依頼を）</span></p>
                  </div>
                  <div class="uk-modal-footer uk-text-right">
                    <button class="uk-button uk-button-default uk-modal-close" type="button">キャンセル</button>
                    <a href="javascript:window.location.replace('{% url 'airs:nanitozo_delete' air_id=air.id pk=my_nanitozo.id %}')" class="uk-button uk-button-danger" type="button">実行</a>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </li>
      {% else %}
      <li><a href="javascript:window.location.replace('{% url 'airs:nanitozo_create' air.id %}')">何卒！</a></li>
      {% endif %}
    </ul>
  </div>
</nav>
<hr class="uk-margin-remove">

{% comment %} <a class="uk-button uk-button-danger uk-width-1-1 uk-margin-bottom" href="#nanitozo-delete" uk-toggle>何卒取消</a> {% endcomment %}

{% endif %}
{% endblock nav %}

{% block content %}

{% with adt=air.started_at|init_rn_datetime:air.ended_at %}
<header class="rn-padding">
  {% if nanitozo_icon_list %}
  <div class="uk-text-right">
    {% for nanitozo_icon in nanitozo_icon_list %}<span uk-icon="{{ nanitozo_icon.0.value }}" class="uk-icon{% if nanitozo_icon.1 %} uk-text-success{% endif %}"></span>{% endfor %}
    {% comment %} <div class="uk-position-relative">
      <span uk-icon="icon: user" class="uk-icon uk-position-absolute uk-background-default"></span>
      <span uk-icon="icon: user" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:12px"></span>
      <span uk-icon="icon: user" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:24px"></span>
      <span uk-icon="icon: happy" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:36px"></span>
      <span uk-icon="icon: happy" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:48px"></span>
      <span uk-icon="icon: happy" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:60px"></span>
      <span uk-icon="icon: star" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:72px"></span>
      <span uk-icon="icon: star" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:84px"></span>
      <span uk-icon="icon: star" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:96px"></span>
      <span uk-icon="icon: comment" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:108px"></span>
      <span uk-icon="icon: comment" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:120px"></span>
      <span uk-icon="icon: comment" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:132px"></span>
      <span uk-icon="icon: paint-bucket" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:144px"></span>
      <span uk-icon="icon: paint-bucket" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:156px"></span>
      <span uk-icon="icon: paint-bucket" class="uk-icon uk-position-absolute uk-background-default" style="margin-left:168px"></span>
    </div> {% endcomment %}
  </div>
  {% endif %}
  <h1 class="uk-text-lead uk-margin-remove">{{ air.name }}</h1>
  <h2 class="uk-text-default uk-margin-remove-top uk-margin-small-bottom">
    {{ air.started_at|rn_ymdhm }} {{ adt.airtime }}<small>min</small>
  </h2>

  {% if air.broadcaster %}

  <div class="uk-flex uk-flex-middle">
    <span uk-icon="icon: microphone" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="{% url 'airs:broadcaster' air.broadcaster.id %}">{{ air.broadcaster.name }}</a></span>
  </div>

  <div class="uk-flex uk-flex-middle">
    <span uk-icon="icon: link" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="{{ air.started_at|radiko_link:air.broadcaster.radiko_identifier }}" target="_blank" rel="noopener noreferrer">radiko</a></span>
    <span class="uk-text-middle uk-margin-small-left"><a href="#" onclick="copyToClipboardAndShowAlert('{{ air.started_at|radiko_link:air.broadcaster.radiko_identifier }}')">URLコピー</a></span>
    <span class="uk-text-middle uk-margin-small-left"><a href="{{ air.started_at|radiko_link_next_week:air.broadcaster.radiko_identifier }}" target="_blank" rel="noopener noreferrer">radiko+1w</a></span>
  </div>

  {% endif %}

  {% if air.program %}
  <div class="uk-flex uk-flex-middle">
    <span uk-icon="icon: info" class="uk-icon"></span>
    <span class="uk-text-middle mgl-s"><a href="{% url 'airs:program' air.program.id %}">{{ air.program.name }}</a></span>
  </div>
  {% endif %}
</header>
{% endwith %}

<hr class="uk-divider-small uk-margin-remove">

{% comment %} 放送概要表示 ここから {% endcomment %}
<div class="rn-padding">
  {% include 'base/block_comment.html' with header='事前告知' description='ネタバレなし（のはず）' comment=air.overview_before nodata='入力なし' %}
  {% include 'base/block_comment.html' with header='番組内容' description='ネタバレあり' comment=air.overview_after nodata='入力なし' %}
</div>
{% comment %} 放送概要表示 ここまで {% endcomment %}

{% comment %} 自分自身の何卒 ここから {% endcomment %}
{% if my_nanitozo %}
{% include 'base/separator.html' %}

<h2 class="rn-padding uk-text-default uk-margin-remove">
  Your何卒
  <span class="uk-text-small">
    <a href="{% url 'airs:nanitozo_update' my_nanitozo.id %}">{% rn_const 'TITLE_NANITOZO_UPDATE' %}</a>
    {% if my_nanitozo.good == True %}
    <a href="javascript:window.location.replace('{% url 'airs:nanitozo_cancel_good' air_id=air.id pk=my_nanitozo.id %}')">{% rn_const 'TITLE_NANITOZO_CANCEL_GOOD' %}</a>
    {% else %}
    <a href="javascript:window.location.replace('{% url 'airs:nanitozo_apply_good' air_id=air.id pk=my_nanitozo.id %}')">{% rn_const 'TITLE_NANITOZO_APPLY_GOOD' %}</a>
    {% endif %}
  </span>
</h2>
<div class="uk-background-muted">
  <div class="rn-padding-card-list">
    <div class="rn-padding uk-background-default">
      {% if my_nanitozo.comment_recommend %}
      {% include 'base/block_comment.html' with header='推し' icon='star' comment=my_nanitozo.comment_recommend %}
      {% endif %}
      {% if my_nanitozo.comment %}
      {% include 'base/block_comment.html' with header='感想' icon='comment' comment=my_nanitozo.comment %}
      {% endif %}
      {% if my_nanitozo.comment_negative %}
      {% include 'base/block_comment.html' with header='ネガ' icon='paint-bucket'  comment=my_nanitozo.comment_negative is_negative=True %}
      {% endif %}
    </div>
  </div>
</div>
{% endif %}
{% comment %} 自分自身の何卒 ここまで {% endcomment %}

{% if other_nanitozo_list %}
{% include 'base/separator.html' %}

<div class="uk-background-muted">
  <div class="rn-padding uk-background-default">
    <h2 class="uk-text-default uk-margin-remove">
      みんなの何卒
    </h2>
    <div>
      {% comment %} 何卒 {% endcomment %}
      {% include 'base/sum_reaction.html' with nanitozo_list=nanitozo_list icon='icon: user' label='何卒' is_negative=False %}
      {% comment %} 満足 {% endcomment %}
      {% include 'base/sum_reaction.html' with nanitozo_list=good_nanitozo_list icon='icon: happy' label='満足' is_negative=False %}
      {% comment %} 推し {% endcomment %}
      {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_recommend_nanitozo_list icon='icon: star' label='推し' is_negative=False %}
      {% comment %} 感想 {% endcomment %}
      {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_nanitozo_list icon='icon: comment' label='感想' is_negative=False %}
      {% comment %} ネガ {% endcomment %}
      {% include 'base/sum_reaction.html' with nanitozo_list=comment_open_negative_nanitozo_list icon='icon: paint-bucket' label='ネガ' is_negative=True %}
    </div>
  </div>

  {% for nanitozo in other_nanitozo_list %}
  {% include 'list/item_reaction.html' with nanitozo=nanitozo %}
  {% endfor %}
</div>
{% endif %}

{% endblock content %}